CC ?= gcc
AR ?= ar

DESTDIR ?= .
CFLAGS := -std=c89 -O1

OBJECTS := \
	$(DESTDIR)/lib/desktop/cJSON/cJSON.o

$(VERBOSE).SILENT:

.PHONY: @all
@all: @clean @lib

$(DESTDIR)/lib:
	mkdir $@

$(DESTDIR)/lib/desktop: | $(DESTDIR)/lib
	mkdir $@

$(DESTDIR)/lib/desktop/cJSON: | $(DESTDIR)/lib/desktop
	mkdir $@

$(OBJECTS): $(DESTDIR)/lib/desktop/cJSON/%.o: src/%.c | $(DESTDIR)/lib/desktop/cJSON
	$(CC) $(CFLAGS) -o $@ -c $<

$(DESTDIR)/lib/desktop/libcJSON.a: $(OBJECTS) | $(DESTDIR)/lib/desktop
	$(AR) rcs $@ $^

.PHONY: @lib
@lib: $(DESTDIR)/lib/desktop/libcJSON.a

.PHONY: @clean
@clean:
	if [ -d "$(DESTDIR)/lib/desktop/cJSON" ]; then rm -r $(DESTDIR)/lib/desktop/cJSON; fi
	if [ -f "$(DESTDIR)/lib/desktop/libcJSON.a" ]; then rm $(DESTDIR)/lib/desktop/libcJSON.a; fi
