EMCC ?= emcc
EMAR ?= emar

DESTDIR ?= .
CFLAGS := -std=c89 -O1

OBJECTS := \
	$(DESTDIR)/lib/web/cJSON/cJSON.o

.PHONY: @all
@all: @clean @lib

$(VERBOSE).SILENT:

$(DESTDIR)/lib:
	mkdir $@

$(DESTDIR)/lib/web: | $(DESTDIR)/lib
	mkdir $@

$(DESTDIR)/lib/web/cJSON: | $(DESTDIR)/lib/web
	mkdir $@

$(OBJECTS): $(DESTDIR)/lib/web/cJSON/%.o: src/%.c | $(DESTDIR)/lib/web/cJSON
	$(EMCC) $(CFLAGS) -o $@ -c $<

$(DESTDIR)/lib/web/libcJSON.a: $(OBJECTS) | $(DESTDIR)/lib/web
	$(EMAR) rcs $@ $^

.PHONY: @lib
@lib: $(DESTDIR)/lib/web/libcJSON.a

.PHONY: @clean
@clean:
	if [ -d "$(DESTDIR)/lib/web/cJSON" ]; then rm -r $(DESTDIR)/lib/web/cJSON; fi
	if [ -f "$(DESTDIR)/lib/web/libcJSON.a" ]; then rm $(DESTDIR)/lib/web/libcJSON.a; fi
