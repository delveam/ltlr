CC ?= gcc
AR ?= ar

DESTDIR ?= .
cflags.vendor := $(shell pkg-config --cflags x11 xcursor xext xfixes xi xinerama xrandr xrender)
CFLAGS := -std=c99 -D_DEFAULT_SOURCE -fPIC -s -O1 -DPLATFORM_DESKTOP -DGRAPHICS_API_OPENGL_33 -Isrc -Isrc/external/glfw/include $(cflags.vendor)

OBJECTS := \
	$(DESTDIR)/lib/desktop/raylib/raudio.o \
	$(DESTDIR)/lib/desktop/raylib/rcore.o \
	$(DESTDIR)/lib/desktop/raylib/rglfw.o \
	$(DESTDIR)/lib/desktop/raylib/rmodels.o \
	$(DESTDIR)/lib/desktop/raylib/rshapes.o \
	$(DESTDIR)/lib/desktop/raylib/rtext.o \
	$(DESTDIR)/lib/desktop/raylib/rtextures.o \
	$(DESTDIR)/lib/desktop/raylib/utils.o \

.PHONY: @all
@all: @clean @lib

$(VERBOSE).SILENT:

$(DESTDIR)/lib:
	mkdir $@

$(DESTDIR)/lib/desktop: | $(DESTDIR)/lib
	mkdir $@

$(DESTDIR)/lib/desktop/raylib: | $(DESTDIR)/lib/desktop
	mkdir $@

$(OBJECTS): $(DESTDIR)/lib/desktop/raylib/%.o: src/%.c | $(DESTDIR)/lib/desktop/raylib
	$(CC) $(CFLAGS) -o $@ -c $<

$(DESTDIR)/lib/desktop/libraylib.a: $(OBJECTS) | $(DESTDIR)/lib/desktop
	$(AR) rcs $@ $^

.PHONY: @lib
@lib: $(DESTDIR)/lib/desktop/libraylib.a

.PHONY: @clean
@clean:
	if [ -d "$(DESTDIR)/lib/desktop/raylib" ]; then rm -r $(DESTDIR)/lib/desktop/raylib; fi
	if [ -f "$(DESTDIR)/lib/desktop/libraylib.a" ]; then rm $(DESTDIR)/lib/desktop/libraylib.a; fi
