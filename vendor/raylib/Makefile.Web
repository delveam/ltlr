EMCC := emcc
EMAR := emar

DESTDIR := .
CFLAGS := -O1 -DPLATFORM_WEB -DGRAPHICS_API_OPENGL_ES2

$(VERBOSE).SILENT:

OBJECTS := \
	$(DESTDIR)/lib/web/raylib/raudio.o \
	$(DESTDIR)/lib/web/raylib/rcore.o \
	$(DESTDIR)/lib/web/raylib/rmodels.o \
	$(DESTDIR)/lib/web/raylib/rshapes.o \
	$(DESTDIR)/lib/web/raylib/rtext.o \
	$(DESTDIR)/lib/web/raylib/rtextures.o \
	$(DESTDIR)/lib/web/raylib/utils.o \

.PHONY: @all
@all: @clean @lib

$(DESTDIR)/lib:
	mkdir $@

$(DESTDIR)/lib/web: | $(DESTDIR)/lib
	mkdir $@

$(DESTDIR)/lib/web/raylib: | $(DESTDIR)/lib/web
	mkdir $@

$(OBJECTS): $(DESTDIR)/lib/web/raylib/%.o: src/%.c | $(DESTDIR)/lib/web/raylib
	$(EMCC) $(CFLAGS) -o $@ -c $<

$(DESTDIR)/lib/web/libraylib.a: $(OBJECTS) | $(DESTDIR)/lib/web
	$(EMAR) rcs $@ $^

.PHONY: @lib
@lib: $(DESTDIR)/lib/web/libraylib.a

.PHONY: @clean
@clean:
	if [ -d "$(DESTDIR)/lib/web/raylib" ]; then rm -r $(DESTDIR)/lib/web/raylib; fi
	if [ -f "$(DESTDIR)/lib/web/libraylib.a" ]; then rm $(DESTDIR)/lib/web/libraylib.a; fi
